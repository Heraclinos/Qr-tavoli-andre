<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Tavoli - Sistema Punti</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì±</text></svg>">
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08); /* Light blue */
  --color-bg-2: rgba(245, 158, 11, 0.08); /* Light yellow */
  --color-bg-3: rgba(34, 197, 94, 0.08); /* Light green */
  --color-bg-4: rgba(239, 68, 68, 0.08); /* Light red */
  --color-bg-5: rgba(147, 51, 234, 0.08); /* Light purple */
  --color-bg-6: rgba(249, 115, 22, 0.08); /* Light orange */
  --color-bg-7: rgba(236, 72, 153, 0.08); /* Light pink */
  --color-bg-8: rgba(6, 182, 212, 0.08); /* Light cyan */

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Common style patterns */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for opacity control */
  --color-success-rgb: 33, 128, 141;
  --color-error-rgb: 192, 21, 47;
  --color-warning-rgb: 168, 75, 47;
  --color-info-rgb: 98, 108, 113;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  /* Layout */
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;

  /* Custom app colors */
  --color-customer-primary: #10b981;
  --color-customer-bg: #ecfdf5;
  --color-cashier-primary: #3b82f6;
  --color-cashier-bg: #eff6ff;
}

/* Dark mode colors */
@media (prefers-color-scheme: dark) {
  :root {
    /* RGB versions for opacity control (Dark Mode) */
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    /* Background color tokens (Dark Mode) */
    --color-bg-1: rgba(29, 78, 216, 0.15); /* Dark blue */
    --color-bg-2: rgba(180, 83, 9, 0.15); /* Dark yellow */
    --color-bg-3: rgba(21, 128, 61, 0.15); /* Dark green */
    --color-bg-4: rgba(185, 28, 28, 0.15); /* Dark red */
    --color-bg-5: rgba(107, 33, 168, 0.15); /* Dark purple */
    --color-bg-6: rgba(194, 65, 12, 0.15); /* Dark orange */
    --color-bg-7: rgba(190, 24, 93, 0.15); /* Dark pink */
    --color-bg-8: rgba(8, 145, 178, 0.15); /* Dark cyan */

    /* Semantic Color Tokens (Dark Mode) */
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

    /* RGB versions for dark mode */
    --color-success-rgb: var(--color-teal-300-rgb);
    --color-error-rgb: var(--color-red-400-rgb);
    --color-warning-rgb: var(--color-orange-400-rgb);
    --color-info-rgb: var(--color-gray-300-rgb);
  }
}

/* Base styles */
html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

/* Typography */
h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

h1 {
  font-size: var(--font-size-4xl);
}
h2 {
  font-size: var(--font-size-3xl);
}
h3 {
  font-size: var(--font-size-2xl);
}
h4 {
  font-size: var(--font-size-xl);
}
h5 {
  font-size: var(--font-size-lg);
}
h6 {
  font-size: var(--font-size-md);
}

p {
  margin: 0 0 var(--space-16) 0;
}

a {
  color: var(--color-primary);
  text-decoration: none;
  transition: color var(--duration-fast) var(--ease-standard);
}

a:hover {
  color: var(--color-primary-hover);
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: 500;
  line-height: 1.5;
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  border: none;
  text-decoration: none;
  position: relative;
}

.btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.btn--primary {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn--primary:hover {
  background: var(--color-primary-hover);
}

.btn--primary:active {
  background: var(--color-primary-active);
}

.btn--secondary {
  background: var(--color-secondary);
  color: var(--color-text);
}

.btn--secondary:hover {
  background: var(--color-secondary-hover);
}

.btn--secondary:active {
  background: var(--color-secondary-active);
}

.btn--outline {
  background: transparent;
  border: 1px solid var(--color-border);
  color: var(--color-text);
}

.btn--outline:hover {
  background: var(--color-secondary);
}

.btn--sm {
  padding: var(--space-4) var(--space-12);
  font-size: var(--font-size-sm);
  border-radius: var(--radius-sm);
}

.btn--lg {
  padding: var(--space-10) var(--space-20);
  font-size: var(--font-size-lg);
  border-radius: var(--radius-md);
}

.btn--full-width {
  width: 100%;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Form elements */
.form-control {
  display: block;
  width: 100%;
  padding: var(--space-8) var(--space-12);
  font-size: var(--font-size-md);
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  transition: border-color var(--duration-fast) var(--ease-standard),
    box-shadow var(--duration-fast) var(--ease-standard);
}

.form-control:focus {
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

.form-label {
  display: block;
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.form-group {
  margin-bottom: var(--space-16);
}

/* Card component */
.card {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: box-shadow var(--duration-normal) var(--ease-standard);
}

.card:hover {
  box-shadow: var(--shadow-md);
}

.card__body {
  padding: var(--space-16);
}

/* Custom App Styles */
.app {
  min-height: 100vh;
  background: linear-gradient(135deg, var(--color-background) 0%, var(--color-bg-3) 100%);
}

.header {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--color-card-border);
  padding: var(--space-16) 0;
  position: sticky;
  top: 0;
  z-index: 100;
}

.header__content {
  max-width: var(--container-lg);
  margin: 0 auto;
  padding: 0 var(--space-16);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.main-content {
  max-width: var(--container-lg);
  margin: 0 auto;
  padding: var(--space-32) var(--space-16);
}

.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--space-24);
  margin-bottom: var(--space-32);
}

.dashboard__title {
  grid-column: 1 / -1;
  text-align: center;
  margin-bottom: var(--space-16);
  font-size: var(--font-size-3xl);
  background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.table-card {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: var(--space-20);
  border: 2px solid transparent;
  transition: all var(--duration-normal) var(--ease-standard);
  position: relative;
  overflow: hidden;
}

.table-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--color-primary), var(--color-primary-hover));
}

.table-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.table-card--highlighted {
  border-color: var(--color-primary);
  background: var(--color-bg-3);
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}

.table-card--highlighted::before {
  height: 6px;
  background: linear-gradient(90deg, var(--color-primary), var(--color-success));
}

.table-card__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-16);
}

.table-card__name {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.table-card__position {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
}

.table-card__points {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
  text-align: center;
  margin: var(--space-16) 0;
}

.table-card__qr {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  text-align: center;
}

.change-name-section {
  background: var(--color-bg-2);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  margin-bottom: var(--space-32);
  border: 1px solid var(--color-card-border);
}

.change-name-section h3 {
  margin-bottom: var(--space-16);
  color: var(--color-text);
}

.name-form {
  display: flex;
  gap: var(--space-12);
  align-items: end;
}

.name-form .form-group {
  flex: 1;
  margin-bottom: 0;
}

/* Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all var(--duration-normal) var(--ease-standard);
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: var(--space-32);
  max-width: 400px;
  width: 90%;
  margin: var(--space-16);
  border: 1px solid var(--color-card-border);
  transform: scale(0.9);
  transition: transform var(--duration-normal) var(--ease-standard);
}

.modal-overlay.active .modal {
  transform: scale(1);
}

.modal__header {
  text-align: center;
  margin-bottom: var(--space-24);
}

.modal__title {
  font-size: var(--font-size-2xl);
  margin-bottom: var(--space-8);
}

.modal__subtitle {
  color: var(--color-text-secondary);
  font-size: var(--font-size-base);
}

.modal__form {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

.modal__actions {
  display: flex;
  gap: var(--space-12);
  margin-top: var(--space-24);
}

.modal__actions .btn {
  flex: 1;
}

/* Cashier Mode */
.cashier-mode {
  background: linear-gradient(135deg, var(--color-cashier-bg) 0%, #dbeafe 100%);
  min-height: 100vh;
}

.cashier-mode .header {
  background: rgba(59, 130, 246, 0.95);
}

.cashier-mode .logo {
  color: var(--color-cashier-primary);
}

.cashier-panel {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: var(--space-32);
  border: 2px solid var(--color-cashier-primary);
  margin-bottom: var(--space-24);
}

.cashier-panel__header {
  text-align: center;
  margin-bottom: var(--space-24);
}

.cashier-panel__title {
  color: var(--color-cashier-primary);
  margin-bottom: var(--space-8);
}

.current-table {
  background: var(--color-bg-1);
  border-radius: var(--radius-base);
  padding: var(--space-20);
  text-align: center;
  margin-bottom: var(--space-32);
  border: 1px solid var(--color-cashier-primary);
}

.current-table__name {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-8);
}

.current-table__points {
  font-size: var(--font-size-4xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-cashier-primary);
}

.points-controls {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-24);
  margin-bottom: var(--space-32);
}

.points-section {
  background: var(--color-bg-1);
  border-radius: var(--radius-lg);
  padding: var(--space-20);
}

.points-section h4 {
  text-align: center;
  margin-bottom: var(--space-16);
  color: var(--color-cashier-primary);
}

.points-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-8);
  margin-bottom: var(--space-16);
}

.points-btn {
  background: var(--color-cashier-primary);
  color: white;
  border: none;
  border-radius: var(--radius-base);
  padding: var(--space-12);
  font-weight: var(--font-weight-semibold);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
}

.points-btn:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.points-btn.negative {
  background: var(--color-error);
}

.custom-points {
  display: flex;
  gap: var(--space-8);
}

.custom-points input {
  flex: 1;
}

/* Toast notifications */
.toast-container {
  position: fixed;
  top: 80px;
  right: var(--space-16);
  z-index: 1100;
  pointer-events: none;
}

.toast {
  background: var(--color-surface);
  border-radius: var(--radius-base);
  padding: var(--space-12) var(--space-16);
  margin-bottom: var(--space-8);
  border-left: 4px solid var(--color-success);
  box-shadow: var(--shadow-lg);
  transform: translateX(100%);
  transition: all var(--duration-normal) var(--ease-standard);
  pointer-events: auto;
  max-width: 300px;
}

.toast.show {
  transform: translateX(0);
}

.toast.error {
  border-left-color: var(--color-error);
}

.toast.warning {
  border-left-color: var(--color-warning);
}

.toast__message {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  margin: 0;
}

/* Loading spinner */
.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid var(--color-border);
  border-radius: 50%;
  border-top-color: var(--color-primary);
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-8);
  padding: var(--space-32);
  color: var(--color-text-secondary);
}

/* User info */
.user-info {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-right: var(--space-16);
}

/* Responsive */
@media (max-width: 768px) {
  .header__content {
    flex-direction: column;
    gap: var(--space-16);
    text-align: center;
  }
  
  .dashboard {
    grid-template-columns: 1fr;
  }
  
  .name-form {
    flex-direction: column;
  }
  
  .points-controls {
    grid-template-columns: 1fr;
  }
  
  .modal__actions {
    flex-direction: column;
  }
  
  .user-info {
    margin-right: 0;
  }
}

/* Hide elements */
.hidden {
  display: none !important;
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}
    </style>
</head>
<body>
    <div id="app" class="app">
        <!-- Header -->
        <header class="header">
            <div class="header__content">
                <div class="logo">
                    üì± QR Tavoli
                </div>
                <div style="display: flex; align-items: center;">
                    <div id="userInfo" class="user-info hidden">
                        üë§ <span id="userName"></span>
                    </div>
                    <button id="loginBtn" class="btn btn--primary btn--sm">Login Cassiere</button>
                    <button id="logoutBtn" class="btn btn--outline btn--sm hidden">Logout</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="mainContent" class="main-content">
            <!-- Dashboard View -->
            <div id="dashboardView" class="dashboard-view">
                <div id="changeNameSection" class="change-name-section hidden">
                    <h3>‚úèÔ∏è Modifica Nome Tavolo</h3>
                    <form id="changeNameForm" class="name-form">
                        <div class="form-group">
                            <label class="form-label" for="newTableName">Nuovo nome:</label>
                            <input type="text" id="newTableName" class="form-control" placeholder="Inserisci nuovo nome..." maxlength="50">
                        </div>
                        <button type="submit" class="btn btn--primary">üíæ Salva</button>
                    </form>
                </div>

                <div id="dashboard" class="dashboard">
                    <h2 class="dashboard__title">üèÜ Classifica Tavoli</h2>
                    <div id="dashboardContent" class="loading">
                        <div class="spinner"></div>
                        <span>Caricamento classifica...</span>
                    </div>
                </div>
            </div>

            <!-- Cashier View -->
            <div id="cashierView" class="cashier-view hidden">
                <div class="cashier-panel">
                    <div class="cashier-panel__header">
                        <h2 class="cashier-panel__title">üíº Modalit√† Cassiere</h2>
                        <p>Gestisci i punti del tavolo selezionato</p>
                    </div>

                    <div id="currentTableInfo" class="current-table">
                        <div class="current-table__name" id="cashierTableName">Nessun tavolo selezionato</div>
                        <div class="current-table__points" id="cashierTablePoints">0</div>
                    </div>

                    <div class="points-controls">
                        <div class="points-section">
                            <h4>‚ûï Aggiungi Punti</h4>
                            <div class="points-buttons">
                                <button class="points-btn" data-points="1">+1</button>
                                <button class="points-btn" data-points="5">+5</button>
                                <button class="points-btn" data-points="10">+10</button>
                                <button class="points-btn" data-points="20">+20</button>
                            </div>
                            <div class="custom-points">
                                <input type="number" id="customAddPoints" class="form-control" placeholder="Personalizzato" min="1" max="100">
                                <button class="btn btn--primary" onclick="addCustomPoints()">Aggiungi</button>
                            </div>
                        </div>

                        <div class="points-section">
                            <h4>‚ûñ Rimuovi Punti</h4>
                            <div class="points-buttons">
                                <button class="points-btn negative" data-points="-1">-1</button>
                                <button class="points-btn negative" data-points="-5">-5</button>
                                <button class="points-btn negative" data-points="-10">-10</button>
                                <button class="points-btn negative" data-points="-20">-20</button>
                            </div>
                            <div class="custom-points">
                                <input type="number" id="customSubPoints" class="form-control" placeholder="Personalizzato" min="1" max="100">
                                <button class="btn btn--outline" onclick="subtractCustomPoints()">Rimuovi</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Login Modal -->
        <div id="loginModal" class="modal-overlay">
            <div class="modal">
                <div class="modal__header">
                    <h3 class="modal__title">üîê Login Cassiere</h3>
                    <p class="modal__subtitle">Inserisci le tue credenziali per accedere</p>
                </div>
                <form id="loginForm" class="modal__form">
                    <div class="form-group">
                        <label class="form-label" for="username">Username:</label>
                        <input type="text" id="username" class="form-control" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="password">Password:</label>
                        <input type="password" id="password" class="form-control" required autocomplete="current-password">
                    </div>
                    <div class="modal__actions">
                        <button type="button" class="btn btn--outline" onclick="closeLoginModal()">Annulla</button>
                        <button type="submit" class="btn btn--primary">Accedi</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container"></div>
    </div>

    <script>
        // API Configuration
        const API_CONFIG = {
            BASE_URL: window.location.hostname === 'localhost' 
                ? 'http://localhost:3000/api'
                : 'https://qr-tavoli-system.onrender.com/api',
            TIMEOUT: 10000,
            SESSION_KEY: 'qr-tavoli-session',
            SESSION_DURATION: 86400000 // 24 hours
        };

        // Mock data for fallback
        const MOCK_DATA = {
            tables: [
                { id: 1, tableNumber: 1, name: "Tavolo 1", points: 85, qrCode: "TABLE_1" },
                { id: 2, tableNumber: 2, name: "Tavolo VIP", points: 92, qrCode: "TABLE_2" },
                { id: 3, tableNumber: 3, name: "Tavolo 3", points: 34, qrCode: "TABLE_3" },
                { id: 4, tableNumber: 4, name: "Tavolo Famiglia", points: 67, qrCode: "TABLE_4" },
                { id: 5, tableNumber: 5, name: "Tavolo 5", points: 23, qrCode: "TABLE_5" }
            ]
        };

        // Application State
        let appState = {
            currentTable: null,
            currentTableQR: null,
            user: null,
            tables: [],
            isOnline: navigator.onLine
        };

        // Utility Functions
        function sanitizeTableName(input) {
            if (!input || typeof input !== 'string') return '';
            return input
                .trim()
                .replace(/[<>"'&]/g, '') // Remove HTML chars
                .replace(/[;\-\-\/\*]/g, '') // Remove SQL chars
                .replace(/script|javascript|vbscript/gi, '') // Remove script tags
                .substring(0, 50); // Max 50 characters
        }

        function validatePoints(points) {
            const num = parseInt(points);
            return !isNaN(num) && num >= -100 && num <= 100;
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<p class="toast__message">${message}</p>`;
            
            container.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(toast)) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // API Functions
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_CONFIG.BASE_URL}${endpoint}`;
            const defaultOptions = {
                timeout: API_CONFIG.TIMEOUT,
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            };

            // Add auth token if available
            const session = getStoredSession();
            if (session && session.token) {
                defaultOptions.headers.Authorization = `Bearer ${session.token}`;
            }

            const config = { ...defaultOptions, ...options };
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), config.timeout);
                
                const response = await fetch(url, {
                    ...config,
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error(`API Error (${endpoint}):`, error);
                throw error;
            }
        }

        async function loadLeaderboard() {
            try {
                const data = await apiRequest('/tables/leaderboard');
                appState.tables = data.tables || [];
                return appState.tables;
            } catch (error) {
                console.warn('Using mock data due to API error:', error);
                appState.tables = MOCK_DATA.tables;
                return appState.tables;
            }
        }

        async function loadTableByQR(qrCode) {
            try {
                const data = await apiRequest(`/tables/qr/${qrCode}`);
                return data.table;
            } catch (error) {
                console.warn('Using mock data for table:', error);
                return MOCK_DATA.tables.find(t => t.qrCode === qrCode);
            }
        }

        async function updateTableName(tableId, newName) {
            try {
                const data = await apiRequest(`/tables/${tableId}/name`, {
                    method: 'PUT',
                    body: JSON.stringify({ name: newName })
                });
                return data.table;
            } catch (error) {
                throw new Error('Errore durante il cambio nome: ' + error.message);
            }
        }

        async function updateTablePoints(tableId, points) {
            try {
                const data = await apiRequest('/points/add', {
                    method: 'POST',
                    body: JSON.stringify({ tableId, points })
                });
                return data.table;
            } catch (error) {
                throw new Error('Errore durante l\'aggiornamento punti: ' + error.message);
            }
        }

        async function loginUser(username, password) {
            try {
                const data = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });
                return data;
            } catch (error) {
                // Fallback to mock login
                if (username === 'cassiere1' && password === 'cassiere123') {
                    return {
                        user: { id: 1, username: 'cassiere1', name: 'Mario Rossi', role: 'cashier' },
                        token: 'mock-jwt-token'
                    };
                }
                if (username === 'admin' && password === 'admin123') {
                    return {
                        user: { id: 2, username: 'admin', name: 'Admin Sistema', role: 'admin' },
                        token: 'mock-jwt-token-admin'
                    };
                }
                throw new Error('Credenziali non valide');
            }
        }

        // Session Management
        function storeSession(user, token) {
            const session = {
                user,
                token,
                timestamp: Date.now()
            };
            try {
                const sessionData = JSON.stringify(session);
                // Use a simple variable storage since localStorage is not available
                window.qrTavoliSession = sessionData;
            } catch (error) {
                console.warn('Cannot store session:', error);
            }
        }

        function getStoredSession() {
            try {
                const sessionData = window.qrTavoliSession;
                if (!sessionData) return null;
                
                const session = JSON.parse(sessionData);
                
                // Check if session is expired
                if (Date.now() - session.timestamp > API_CONFIG.SESSION_DURATION) {
                    clearSession();
                    return null;
                }
                
                return session;
            } catch (error) {
                console.warn('Cannot read session:', error);
                return null;
            }
        }

        function clearSession() {
            try {
                window.qrTavoliSession = null;
            } catch (error) {
                console.warn('Cannot clear session:', error);
            }
        }

        // UI Functions
        function renderDashboard(tables, highlightQR = null) {
            const container = document.getElementById('dashboardContent');
            
            if (!tables || tables.length === 0) {
                container.innerHTML = '<div class="loading">Nessun tavolo disponibile</div>';
                return;
            }

            // Sort by points descending
            const sortedTables = [...tables].sort((a, b) => b.points - a.points);
            
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            
            container.innerHTML = sortedTables.map((table, index) => {
                const isHighlighted = table.qrCode === highlightQR;
                const medal = index < 3 ? medals[index] : `#${index + 1}`;
                
                return `
                    <div class="table-card ${isHighlighted ? 'table-card--highlighted' : ''}">
                        <div class="table-card__header">
                            <div class="table-card__name">${table.name}</div>
                            <div class="table-card__position">${medal}</div>
                        </div>
                        <div class="table-card__points">${table.points} ‚≠ê</div>
                        <div class="table-card__qr">üì± ${table.qrCode}</div>
                    </div>
                `;
            }).join('');
        }

        function showChangeNameSection(table) {
            const section = document.getElementById('changeNameSection');
            const input = document.getElementById('newTableName');
            
            section.classList.remove('hidden');
            input.value = table.name;
            input.focus();
            
            appState.currentTable = table;
        }

        function hideChangeNameSection() {
            document.getElementById('changeNameSection').classList.add('hidden');
            appState.currentTable = null;
        }

        function showCashierView(table) {
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('cashierView').classList.remove('hidden');
            document.getElementById('app').classList.add('cashier-mode');
            
            // Update current table info
            document.getElementById('cashierTableName').textContent = table.name;
            document.getElementById('cashierTablePoints').textContent = table.points;
            
            appState.currentTable = table;
        }

        function showDashboardView() {
            document.getElementById('cashierView').classList.add('hidden');
            document.getElementById('dashboardView').classList.remove('hidden');
            document.getElementById('app').classList.remove('cashier-mode');
        }

        function updateUserUI(user) {
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (user) {
                userInfo.classList.remove('hidden');
                userName.textContent = user.name || user.username;
                loginBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
            } else {
                userInfo.classList.add('hidden');
                loginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
            }
        }

        // Modal Functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
            document.getElementById('username').focus();
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('loginForm').reset();
        }

        // Event Handlers
        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showToast('Inserisci username e password', 'error');
                return;
            }
            
            try {
                const submitBtn = event.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Accesso...';
                submitBtn.disabled = true;
                
                const loginData = await loginUser(username, password);
                
                storeSession(loginData.user, loginData.token);
                appState.user = loginData.user;
                
                updateUserUI(loginData.user);
                closeLoginModal();
                
                showToast(`Benvenuto, ${loginData.user.name}!`, 'success');
                
                // If we have a current table QR, switch to cashier mode
                if (appState.currentTableQR) {
                    const table = await loadTableByQR(appState.currentTableQR);
                    if (table) {
                        showCashierView(table);
                    }
                }
                
            } catch (error) {
                showToast(error.message, 'error');
            } finally {
                const submitBtn = event.target.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Accedi';
                submitBtn.disabled = false;
            }
        }

        function handleLogout() {
            clearSession();
            appState.user = null;
            updateUserUI(null);
            showDashboardView();
            hideChangeNameSection();
            showToast('Logout effettuato', 'success');
            
            // Reload dashboard to remove any highlighting
            loadAndRenderDashboard();
        }

        async function handleChangeTableName(event) {
            event.preventDefault();
            
            const newName = sanitizeTableName(document.getElementById('newTableName').value);
            
            if (!newName || newName.length < 1) {
                showToast('Inserisci un nome valido (1-50 caratteri)', 'error');
                return;
            }
            
            if (!appState.currentTable) {
                showToast('Nessun tavolo selezionato', 'error');
                return;
            }
            
            try {
                const submitBtn = event.target.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<div class="spinner"></div> Salvataggio...';
                
                const updatedTable = await updateTableName(appState.currentTable.id, newName);
                
                // Update local state
                const tableIndex = appState.tables.findIndex(t => t.id === updatedTable.id);
                if (tableIndex !== -1) {
                    appState.tables[tableIndex] = updatedTable;
                }
                appState.currentTable = updatedTable;
                
                // Re-render dashboard
                renderDashboard(appState.tables, appState.currentTableQR);
                
                showToast('Nome aggiornato con successo!', 'success');
                hideChangeNameSection();
                
            } catch (error) {
                showToast(error.message, 'error');
            } finally {
                const submitBtn = event.target.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'üíæ Salva';
            }
        }

        async function handlePointsUpdate(points) {
            if (!appState.currentTable || !appState.user) {
                showToast('Accesso necessario per modificare i punti', 'error');
                return;
            }
            
            if (!validatePoints(points)) {
                showToast('Punti non validi (range: -100/+100)', 'error');
                return;
            }
            
            try {
                const updatedTable = await updateTablePoints(appState.currentTable.id, points);
                
                // Update local state
                const tableIndex = appState.tables.findIndex(t => t.id === updatedTable.id);
                if (tableIndex !== -1) {
                    appState.tables[tableIndex] = updatedTable;
                }
                appState.currentTable = updatedTable;
                
                // Update cashier view
                document.getElementById('cashierTablePoints').textContent = updatedTable.points;
                
                const action = points > 0 ? 'aggiunti' : 'rimossi';
                showToast(`${Math.abs(points)} punti ${action} con successo!`, 'success');
                
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        // Points control functions
        function addCustomPoints() {
            const input = document.getElementById('customAddPoints');
            const points = parseInt(input.value);
            if (points && points > 0) {
                handlePointsUpdate(points);
                input.value = '';
            }
        }

        function subtractCustomPoints() {
            const input = document.getElementById('customSubPoints');
            const points = parseInt(input.value);
            if (points && points > 0) {
                handlePointsUpdate(-points);
                input.value = '';
            }
        }

        // Main application functions
        async function loadAndRenderDashboard() {
            const container = document.getElementById('dashboardContent');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Caricamento classifica...</span></div>';
            
            try {
                const tables = await loadLeaderboard();
                renderDashboard(tables, appState.currentTableQR);
            } catch (error) {
                container.innerHTML = '<div class="loading">Errore nel caricamento della classifica</div>';
                console.error('Dashboard load error:', error);
            }
        }

        function parseURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const tableQR = urlParams.get('table');
            
            if (tableQR && /^TABLE_\d+$/.test(tableQR)) {
                appState.currentTableQR = tableQR;
                return tableQR;
            }
            
            appState.currentTableQR = null;
            return null;
        }

        async function initializeApp() {
            // Check for stored session
            const session = getStoredSession();
            if (session) {
                appState.user = session.user;
                updateUserUI(session.user);
            }
            
            // Parse URL parameters
            const tableQR = parseURLParams();
            
            // Load dashboard
            await loadAndRenderDashboard();
            
            // Handle QR scan logic
            if (tableQR) {
                try {
                    const table = await loadTableByQR(tableQR);
                    if (table) {
                        if (appState.user && (appState.user.role === 'cashier' || appState.user.role === 'admin')) {
                            // User is logged in as cashier - show cashier mode
                            showCashierView(table);
                        } else {
                            // User is not logged in - show change name section and highlight table
                            showChangeNameSection(table);
                            renderDashboard(appState.tables, tableQR);
                        }
                    } else {
                        showToast('Tavolo non trovato', 'error');
                    }
                } catch (error) {
                    showToast('Errore nel caricamento del tavolo', 'error');
                }
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Login/Logout buttons
            document.getElementById('loginBtn').addEventListener('click', showLoginModal);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Change name form
            document.getElementById('changeNameForm').addEventListener('submit', handleChangeTableName);
            
            // Points buttons
            document.querySelectorAll('.points-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const points = parseInt(btn.dataset.points);
                    handlePointsUpdate(points);
                });
            });
            
            // Custom points inputs - Enter key support
            document.getElementById('customAddPoints').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addCustomPoints();
                }
            });
            
            document.getElementById('customSubPoints').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    subtractCustomPoints();
                }
            });
            
            // Close modal on overlay click
            document.getElementById('loginModal').addEventListener('click', (e) => {
                if (e.target.classList.contains('modal-overlay')) {
                    closeLoginModal();
                }
            });
            
            // Online/offline detection
            window.addEventListener('online', () => {
                appState.isOnline = true;
                showToast('Connessione ripristinata', 'success');
                loadAndRenderDashboard();
            });
            
            window.addEventListener('offline', () => {
                appState.isOnline = false;
                showToast('Modalit√† offline attiva', 'warning');
            });
            
            // Initialize app
            initializeApp();
        });

        // Expose global functions for onclick handlers
        window.addCustomPoints = addCustomPoints;
        window.subtractCustomPoints = subtractCustomPoints;
        window.closeLoginModal = closeLoginModal;
    </script>
</body>
</html>
